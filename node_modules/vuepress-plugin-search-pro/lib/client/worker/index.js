import{search as O,getStoredFields as z,autoSuggest as C,loadJSONIndex as F}from"slimsearch";import T from"@temp/search-pro/index.js";import{entries as $}from"@vuepress/helper/client";const S=(e,l)=>{const i=e.toLowerCase(),o=l.toLowerCase(),t=[];let s=0,n=0;const r=(c,g=!1)=>{let u="";n===0?u=c.length>20?`… ${c.slice(-20)}`:c:g?u=c.length+n>100?`${c.slice(0,100-n)}… `:c:u=c.length>20?`${c.slice(0,20)} … ${c.slice(-20)}`:c,u&&t.push(u),n+=u.length,g||(t.push(["mark",l]),n+=l.length,n>=100&&t.push(" …"))};let p=i.indexOf(o,s);if(p===-1)return null;for(;p>=0;){const c=p+o.length;if(r(e.slice(s,p)),s=c,n>100)break;p=i.indexOf(o,s)}return n<100&&r(e.slice(s),!0),t},b=(e,l)=>l.contents.reduce((i,[,o])=>i+o,0)-e.contents.reduce((i,[,o])=>i+o,0),w=(e,l)=>Math.max(...l.contents.map(([,i])=>i))-Math.max(...e.contents.map(([,i])=>i)),M=(e,l,i={})=>{const o={};return O(l,e,{boost:{h:2,t:1,c:4},prefix:!0,...i}).forEach(t=>{const{id:s,terms:n,score:r}=t,p=s.includes("@"),c=s.includes("#"),[g,u]=s.split(/[#@]/),f=Number(g),m=n.sort((h,a)=>h.length-a.length).filter((h,a)=>n.slice(a+1).every(d=>!d.includes(h))),{contents:y}=o[f]??={title:"",contents:[]};if(p)y.push([{type:"customField",id:f,index:u,display:m.map(h=>t.c.map(a=>S(a,h))).flat().filter(h=>h!==null)},r]);else{const h=m.map(a=>S(t.h,a)).filter(a=>a!==null);if(h.length&&y.push([{type:c?"heading":"title",id:f,...c&&{anchor:u},display:h},r]),"t"in t)for(const a of t.t){const d=m.map(x=>S(a,x)).filter(x=>x!==null);d.length&&y.push([{type:"text",id:f,...c&&{anchor:u},display:d},r])}}}),$(o).sort(([,t],[,s])=>SEARCH_PRO_SORT_STRATEGY==="total"?b(t,s):w(t,s)).map(([t,{title:s,contents:n}])=>{if(!s){const r=z(l,t);r&&(s=r.h)}return{title:s,contents:n.map(([r])=>r)}})},R=(e,l,i={})=>C(l,e,{fuzzy:.2,maxFuzzy:3,...i}).map(({suggestion:o})=>o);self.onmessage=async({data:{type:e="all",query:l,locale:i,options:o,id:t}})=>{const{default:s}=await T[i??"/"](),n=F(s,{fields:["h","t","c"],storeFields:["h","t","c"]});e==="suggest"?self.postMessage([e,t,R(l,n,o)]):e==="search"?self.postMessage([e,t,M(l,n,o)]):self.postMessage({suggestions:[e,t,R(l,n,o)],results:[e,t,M(l,n,o)]})};
//# sourceMappingURL=index.js.map
