import{getPageExcerpt as I,entries as x,fromEntries as O,isArray as P,keys as q,ensureEndingSlash as _,Logger as j,getLocaleConfig as $,addViteOptimizeDepsInclude as J,addViteSsrNoExternal as F}from"@vuepress/helper";import{watch as K}from"chokidar";import{useSassPalettePlugin as B}from"vuepress-plugin-sass-palette";import{createConverter as G}from"vuepress-shared/node";import{load as M}from"cheerio";import{createIndex as W,addAllAsync as Z,discard as b,addAll as V,vacuum as C}from"slimsearch";import{getDirname as U,path as w,fs as R}from"vuepress/utils";const X=e=>{const{deprecatedLogger:t}=G("search-pro");t({options:e,old:"fullIndex",new:"indexContent"}),t({options:e,old:"historyCount",new:"resultHistoryCount"}),t({options:e,old:"delay",new:"searchDelay"})},Y=e=>{const{pages:t,pluginApi:i}=e;i.plugins.some(({name:s})=>s==="@vuepress/plugin-blog")||t.some(s=>"excerpt"in s.data)||t.forEach(s=>{s.data.excerpt=I(e,s,{length:300})})},Q="h2,h3,h4,h5,h6".split(","),ee="header,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,li,main,ol,p,ul,caption,table,thead,tbody,tfoot,th,tr,td,datalist,fieldset,form,legend,optgroup,option,select,details,dialog,menu,menuitem,summary,blockquote,pre".split(","),te="routerlink,a,b,abbr,bdi,bdo,cite,code,dfn,em,i,kbd,mark,q,rp,rt,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,del,ins,button,label,legend,meter,optgroup,option,output,progress,select".split(","),ae=e=>e.type==="comment"&&e.data.trim()==="more",ie=M(""),se=e=>(e.children.length===1&&e.children[0].type==="tag"&&e.children[0].tagName==="a"&&e.children[0].attribs.class==="header-anchor"&&(e.children=e.children[0].children[0].children),e.children.map(t=>t.type==="text"?t.data:null).filter(Boolean).join(" ").replace(/\s+/gu," ").trim()),A=(e,t,i=[],s=!1)=>{const{contentRendered:d,data:a,title:l}=e,n=t.addItem(e.path).toString(),o="excerpt"in a&&a.excerpt.length,c={id:n,h:l},u=[c];let p=o||s,h=null,y="",f=!0;const k=(r,g=!1)=>{if(r.type==="tag")if(Q.includes(r.name)){const{id:m}=r.attribs,S=se(r);y&&p&&(((f?c:h).t??=[]).push(y.replace(/\s+/gu," ")),y=""),m?(f?f=!1:u.push(h),h={id:`${n}#${m}`,h:S}):S&&((h??c).t??=[]).push(S)}else ee.includes(r.name)?(y&&p&&(((f?c:h).t??=[]).push(y.replace(/\s+/gu," ")),y=""),r.childNodes.forEach(m=>k(m,g||r.name==="pre"))):te.includes(r.name)&&r.childNodes.forEach(m=>k(m,g));else r.type==="text"?y+=g||r.data.trim()?r.data:"":o&&!s&&ae(r)&&(p=!1)},E=ie.parseHTML(d),T=O(i.map(({getter:r},g)=>{const m=r(e);return P(m)?[g.toString(),m]:m?[g.toString(),[m]]:null}).filter(r=>r!==null));return!E?.length&&!q(T).length?[]:(E?.forEach(r=>{k(r)}),p&&y&&((f?c:h).t??=[]).push(y),h&&u.push(h),x(T).forEach(([r,g])=>{u.push({id:`${n}@${r}`,c:g})}),u)},re=async(e,{customFields:t,indexContent:i,filter:s=()=>!0,indexOptions:d,indexLocaleOptions:a},l)=>{const n={};e.pages.forEach(c=>{s(c)&&c.frontmatter.search!==!1&&(n[c.pathLocale]??=[]).push(...A(c,l,t,i))});const o={};return await Promise.all(x(n).map(async([c,u])=>{const p=W({...d,...a?.[c],fields:["h","t","c"],storeFields:["h","a","t","c"]});await Z(p,u),o[c]=p})),o},N=U(import.meta.url),z=_(w.resolve(N,"../client/")),ne=w.resolve(N,"../worker/index.js"),H="vuepress-plugin-search-pro",oe=new j(H),v=e=>e.replace(/\//g,"")||"root";class le{constructor(){this.store=[]}addItem(t){const i=this.store.indexOf(t);return i===-1?(this.store.push(t),this.store.length-1):i}addItems(t){return t.map(i=>this.addItem(i))}clearItem(t){const i=this.store.indexOf(t);i!==-1&&(this.store[i]="")}toJSON(){return JSON.stringify(this.store)}}const ce=async(e,t,i)=>{const s=e.dir.dest(t.worker||"search-pro.worker.js"),d=JSON.stringify(i),a=await R.readFile(ne,"utf8");await R.ensureDir(w.dirname(s)),await R.writeFile(s,a.replace("SEARCH_PRO_INDEX",()=>`${JSON.stringify(d)}`).replace("SEARCH_PRO_SORT_STRATEGY",JSON.stringify(t.sortStrategy||"max")))},ue={"/en/":{cancel:"Cancel",placeholder:"Search",search:"Search",searching:"Searching",defaultTitle:"Documentation",select:"to select",navigate:"to navigate",autocomplete:"to autocomplete",exit:"to exit",queryHistory:"Search History",resultHistory:"Result History",emptyHistory:"Empty Search History",emptyResult:"No results found",loading:"Loading search indexes..."},"/zh/":{cancel:"取消",placeholder:"搜索",search:"搜索",searching:"搜索中",defaultTitle:"文档",select:"选择",navigate:"切换",autocomplete:"自动补全",exit:"关闭",queryHistory:"搜索历史",resultHistory:"历史结果",emptyHistory:"无搜索历史",emptyResult:"没有找到结果",loading:"正在加载搜索索引..."},"/zh-tw/":{cancel:"取消",placeholder:"搜索",search:"搜素",searching:"搜索中",defaultTitle:"文檔",select:"選擇",navigate:"切換",autocomplete:"自動補全",exit:"關閉",queryHistory:"搜索歷史",resultHistory:"歷史結果",emptyHistory:"無搜索歷史",emptyResult:"沒有找到結果",loading:"正在加載搜索索引..."},"/de/":{cancel:"Abbrechen",placeholder:"Suche",search:"Suche",searching:"Suche",defaultTitle:"Dokumentation",select:"auswählen",navigate:"wechseln",autocomplete:"automatisch vervollständigen",exit:"schließen",queryHistory:"Suchverlauf",resultHistory:"Ergebnisverlauf",emptyHistory:"Suchverlauf leeren",emptyResult:"Keine Ergebnisse gefunden",loading:"Suchindex wird geladen..."},"/de-at/":{cancel:"Abbrechen",placeholder:"Suche",search:"Suche",searching:"Suche",defaultTitle:"Dokumentation",select:"auswählen",navigate:"wechseln",autocomplete:"automatisch vervollständigen",exit:"schließen",queryHistory:"Suchverlauf",resultHistory:"Ergebnisverlauf",emptyHistory:"Suchverlauf leeren",emptyResult:"Keine Ergebnisse gefunden",loading:"Suchindex wird geladen..."},"/vi/":{cancel:"Hủy",placeholder:"Tìm kiếm",search:"Tìm kiếm",searching:"Đang tìm kiếm",defaultTitle:"Tài liệu",select:"chọn",navigate:"chuyển",autocomplete:"tự động hoàn thành",exit:"đóng",queryHistory:"Lịch sử tìm kiếm",resultHistory:"Lịch sử kết quả",emptyHistory:"Xóa lịch sử tìm kiếm",emptyResult:"Không tìm thấy kết quả",loading:"Đang tải chỉ mục tìm kiếm..."},"/uk/":{cancel:"Скасувати",placeholder:"Пошук",search:"Пошук",searching:"Пошук",defaultTitle:"Документація",select:"вибрати",navigate:"перейти",autocomplete:"автозаповнення",exit:"закрити",queryHistory:"Історія пошуку",resultHistory:"Історія результатів",emptyHistory:"Очистити історію пошуку",emptyResult:"Нічого не знайдено",loading:"Завантаження пошукових індексів..."},"/ru/":{cancel:"Отмена",placeholder:"Поиск",search:"Поиск",searching:"Поиск",defaultTitle:"Документация",select:"выбрать",navigate:"переключить",autocomplete:"автозаполнение",exit:"закрыть",queryHistory:"История поиска",resultHistory:"История результатов",emptyHistory:"Очистить историю поиска",emptyResult:"Ничего не найдено",loading:"Загрузка поисковых индексов..."},"/br/":{cancel:"Cancelar",placeholder:"Pesquisar",search:"Pesquisar",searching:"Pesquisando",defaultTitle:"Documentação",select:"selecionar",navigate:"navegar",autocomplete:"autocompletar",exit:"fechar",queryHistory:"Histórico de pesquisa",resultHistory:"Histórico de resultados",emptyHistory:"Limpar histórico de pesquisa",emptyResult:"Nenhum resultado encontrado",loading:"Carregando índices de pesquisa..."},"/pl/":{cancel:"Anuluj",placeholder:"Szukaj",search:"Szukaj",searching:"Szukanie",defaultTitle:"Dokumentacja",select:"wybierz",navigate:"przejdź",autocomplete:"autouzupełnianie",exit:"zamknij",queryHistory:"Historia wyszukiwania",resultHistory:"Historia wyników",emptyHistory:"Wyczyść historię wyszukiwania",emptyResult:"Nie znaleziono wyników",loading:"Ładowanie indeksów wyszukiwania..."},"/sk/":{cancel:"Zrušiť",placeholder:"Hľadať",search:"Hľadať",searching:"Hľadanie",defaultTitle:"Dokumentácia",select:"vybrať",navigate:"prepnúť",autocomplete:"automatické dopĺňanie",exit:"zavrieť",queryHistory:"História vyhľadávania",resultHistory:"História výsledkov",emptyHistory:"Vymazať históriu vyhľadávania",emptyResult:"Nenašli sa žiadne výsledky",loading:"Načítavajú sa vyhľadávacie indexy..."},"/fr/":{cancel:"Annuler",placeholder:"Rechercher",search:"Rechercher",searching:"Recherche",defaultTitle:"Documentation",select:"sélectionner",navigate:"naviguer",autocomplete:"auto-complétion",exit:"fermer",queryHistory:"Historique de recherche",resultHistory:"Historique des résultats",emptyHistory:"Vider l'historique de recherche",emptyResult:"Aucun résultat trouvé",loading:"Chargement des index de recherche..."},"/es/":{cancel:"Cancelar",placeholder:"Buscar",search:"Buscar",searching:"Buscando",defaultTitle:"Documentación",select:"seleccionar",navigate:"navegar",autocomplete:"autocompletar",exit:"cerrar",queryHistory:"Historial de búsqueda",resultHistory:"Historial de resultados",emptyHistory:"Vaciar historial de búsqueda",emptyResult:"No se encontraron resultados",loading:"Cargando índices de búsqueda..."},"/ja/":{cancel:"キャンセル",placeholder:"検索",search:"検索",searching:"検索中",defaultTitle:"ドキュメント",select:"選択",navigate:"切り替え",autocomplete:"オートコンプリート",exit:"閉じる",queryHistory:"検索履歴",resultHistory:"結果履歴",emptyHistory:"検索履歴をクリア",emptyResult:"結果が見つかりません",loading:"検索インデックスを読み込んでいます..."},"/tr/":{cancel:"İptal",placeholder:"Ara",search:"Ara",searching:"Aranıyor",defaultTitle:"Dökümantasyon",select:"seç",navigate:"geç",autocomplete:"otomatik tamamlama",exit:"kapat",queryHistory:"Arama geçmişi",resultHistory:"Sonuç geçmişi",emptyHistory:"Arama geçmişini temizle",emptyResult:"Sonuç bulunamadı",loading:"Arama dizinleri yükleniyor..."},"/ko/":{cancel:"취소",placeholder:"검색",search:"검색",searching:"검색 중",defaultTitle:"문서",select:"선택",navigate:"이동",autocomplete:"자동 완성",exit:"닫기",queryHistory:"검색 기록",resultHistory:"결과 기록",emptyHistory:"검색 기록 지우기",emptyResult:"결과를 찾을 수 없습니다",loading:"검색 인덱스를 로드하는 중..."},"/fi/":{cancel:"Peruuta",placeholder:"Etsi",search:"Etsi",searching:"Etsitään",defaultTitle:"Dokumentaatio",select:"valitaksesi",navigate:"navigoidaksesi",autocomplete:"automaattinen täydennys",exit:"poistuaksesi",queryHistory:"Hakuhistoria",resultHistory:"Tuloshistoria",emptyHistory:"Tyhjennä hakuhistoria",emptyResult:"Tuloksia ei löytynyt",loading:"Ladataan hakuindeksiä..."},"/hu/":{cancel:"Mégse",placeholder:"Keresés",search:"Keresés",searching:"Keresés",defaultTitle:"Dokumentáció",select:"kiválasztáshoz",navigate:"navigáláshoz",autocomplete:"automatikus kiegészítés",exit:"kilépéshez",queryHistory:"Keresési előzmények",resultHistory:"Eredmények előzményei",emptyHistory:"Üres keresési előzmények",emptyResult:"Nincs találat",loading:"A keresési indexek betöltése..."},"/id/":{cancel:"Batal",placeholder:"Cari sesuatu 🔎",search:"Cari",searching:"Sedang mencari",defaultTitle:"Dokumentasi",select:"pilih",navigate:"navigasi",autocomplete:"autoselesai",exit:"keluar",queryHistory:"Riwayat Penelusuran",resultHistory:"Riwayat Hasil",emptyHistory:"Tidak ada riwayat penelusuran",emptyResult:"Hasil penelusuran tidak tersedia",loading:"Memuat indeks penelusuran..."},"/nl/":{cancel:"Annuleren",placeholder:"Zoeken",search:"Zoeken",searching:"Zoeken",defaultTitle:"Documentatie",select:"Selecteren",navigate:"to navigate",autocomplete:"autocompletion",exit:"to exit",queryHistory:"Zoekgeschiedenis",resultHistory:"Resultaatgeschiedenis",emptyHistory:"Zoekgeschiedenis Leegmaken",emptyResult:"Geen resultaten gevonden",loading:"Laden van zoekindexen..."}},de=async(e,t)=>{await Promise.all(x(t).map(([i,s])=>e.writeTemp(`search-pro/${v(i)}.js`,`export default ${JSON.stringify(JSON.stringify(s))};`))),await e.writeTemp("search-pro/index.js",`export default {${q(t).map(i=>`${JSON.stringify(i)}: () => import('./${v(i)}.js')`).join(",")}}`)},L=async(e,t,i,s,d)=>{const a=d.replace(/^pages\//,"").replace(/\/index\.html\.vue/,"/README.md").replace(/\.html\.vue/,".md"),l=e.pages.find(({filePathRelative:n})=>n?.toLowerCase()===a.toLowerCase());if(l){const n=A(l,s,t.customFields,t.indexContent),{pathLocale:o}=l,c=s.addItem(l.path).toString(),u=i[o];if(n){Array.from(u._documentIds.values()).filter(h=>h.startsWith(c)).forEach(h=>b(u,h)),V(u,n),await C(u);const p=`export default ${JSON.stringify(JSON.stringify(u))}
`;await e.writeTemp(`search-pro/${v(o)}.js`,p);return}}},he=async(e,t,i,s)=>{const d=s.replace(/^pages\//,"").replace(/\/index\.html\.vue/,"/readme.md").replace(/\.html\.vue/,".md"),{pages:a,writeTemp:l}=e,n=a.find(({filePathRelative:o})=>o?.toLowerCase()===d.toLowerCase());if(n){const{pathLocale:o}=n,c=i.addItem(n.path).toString(),u=t[o];Array.from(u._documentIds.values()).filter(h=>h.startsWith(c)).forEach(h=>b(u,h)),await C(u);const p=`export default ${JSON.stringify(JSON.stringify(u))}
`;await l(`search-pro/${v(o)}.js`,p);return}},pe=async(e,t)=>{await e.writeTemp("search-pro/store.js",`export const store = ${t.toJSON()};
`)},me=(e,t=!0)=>i=>{t&&X(e),i.env.isDebug&&oe.info("Options:",e),B(i,{id:"hope"});const s=new le;let d=null;return{name:H,alias:{[`${H}/result`]:`${z}components/SearchResult.js`},define:{SEARCH_PRO_ENABLE_AUTO_SUGGESTIONS:e.autoSuggestions!==!1,SEARCH_PRO_CUSTOM_FIELDS:O((e.customFields||[]).map(({formatter:a},l)=>a?[l.toString(),a]:null).filter(a=>a!==null)),SEARCH_PRO_LOCALES:$({app:i,name:H,config:e.locales,default:ue}),SEARCH_PRO_OPTIONS:{searchDelay:e.searchDelay??150,suggestDelay:e.suggestDelay??0,queryHistoryCount:e.queryHistoryCount??5,resultHistoryCount:e.resultHistoryCount??5,hotKeys:e.hotKeys||[{key:"k",ctrl:!0},{key:"/",ctrl:!0}],worker:e.worker||"search-pro.worker.js"},SEARCH_PRO_SORT_STRATEGY:JSON.stringify(e.sortStrategy||"max")},clientConfigFile:`${z}config.js`,extendsBundlerOptions:(a,l)=>{J(a,l,"slimsearch",!0),F(a,l,["@vuepress/helper","fflate","vuepress-shared"])},onInitialized:async a=>{Y(a),d=await re(a,e,s)},onPrepared:async a=>{a.env.isDev&&await de(a,d),await pe(a,s)},onWatched:(a,l)=>{if("hotReload"in e?e.hotReload:a.env.isDebug){const n=K("pages/**/*.vue",{cwd:a.dir.temp(),ignoreInitial:!0});n.on("add",o=>{L(a,e,d,s,o)}),n.on("change",o=>{L(a,e,d,s,o)}),n.on("unlink",o=>{he(a,d,s,o)}),l.push(n)}},onGenerated:a=>ce(a,e,d)}};var D=(e=>(e.heading="h",e.anchor="a",e.text="t",e.customFields="c",e))(D||{});export{D as IndexField,me as searchProPlugin};
//# sourceMappingURL=index.js.map
